#!/bin/sh

##################################################################
# Usage
##################################################################

Usage() {
  echo "usage: ./install [config]"
  echo
  echo "config:"
  echo "    brew         - install brew (only OS X)"
  echo "    vim          - install vim with lua and extra settings"
  echo "    zsh          - install zsh and change default to zsh"
  echo "    powerline    - install python and powerline"
  echo "    tmux         - install tmux"
  echo "    link         - link all dotfiles to $HOME"
  echo
}

##################################################################
# Brew
##################################################################

InstallBrew() {
    if [ "$OS" = "Mac" ]; then
        ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    else
        echo "Brew is only available for OS X"
        Usage
    fi
}

##################################################################
# Vim
##################################################################

InstallVim() {
    if [ "$OS" = "Mac" ]; then
        brew install vim --with-lua
    elif [ "$OS" = "Linux" ]; then
        sudo apt-get remove --purge vim vim-runtime vim-gnome vim-tiny vim-common vim-gui-common
        sudo apt-get install liblua5.1-dev luajit libluajit-5.1 python-dev ruby-dev libperl-dev mercurial libncurses5-dev libgnome2-dev libgnomeui-dev libgtk2.0-dev libatk1.0-dev libbonoboui2-dev libcairo2-dev libx11-dev libxpm-dev libxt-dev
        sudo mkdir -p /usr/include/lua5.1/include
        sudo ln -sf /usr/include/luajit-2.0 /usr/include/lua5.1/include

        mkdir -p ~/tmp && cd ~/tmp || exit
        git clone https://github.com/vim/vim.git
        cd vim/src || exit
        make distclean
        ./configure --with-features=huge \
                  --enable-rubyinterp \
                  --enable-largefile \
                  --disable-netbeans \
                  --enable-pythoninterp \
                  --with-python-config-dir=/usr/lib/python2.7/config-x86_64-linux-gnu \
                  --enable-perlinterp \
                  --enable-luainterp \
                  --with-luajit \
                  --enable-gui=auto \
                  --enable-fail-if-missing \
                  --with-lua-prefix=/usr/include/lua5.1 \
                  --enable-cscope
        make

        sudo make install

        cd .. || exit
        sudo mkdir -p /usr/share/vim
        sudo mkdir -p /usr/share/vim/vim74
        sudo cp -fr runtime/* /usr/share/vim/vim74/
    else
        Usage
    fi
}


##################################################################
# Zsh
##################################################################

InstallZsh() {
    if [ "$OS" = "Linux" ]; then
        brew install zsh
    elif [ "$OS" = "Linux" ]; then
        sudo apt-get install zsh
    fi
    echo '/usr/local/bin/zsh' >> /etc/shells
    chsh -s /usr/local/bin/zsh
}

InstallOhMyZsh() {
  sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
}


##################################################################
# Powerline
##################################################################

InstallPython() {
    if [ "$OS" = "Mac" ]; then
        brew install python
        CheckPyVersion
    elif [ "$OS" = "Linux" ]; then
        sudo apt-get -y install python
        sudo apt-get -y install python-pip
    fi
}

InstallPowerline() {
  pip install --user powerline-status
  mkdir -p ~/tmp && cd ~/tmp || exit
  git clone git@github.com:powerline/fonts.git
  fonts/install.sh

  echo "*************************************************************"
  echo "Please set font to 'Meslo LG S for Powerline'"
  echo "*************************************************************"

  echo "Adding path to .zshrc"
}


##################################################################
# Tmux
##################################################################

InstallTmux() {
    if [ "$OS" = "Mac" ]; then
        brew install tmux
    elif [ "$OS" = "Linux" ]; then
        sudo apt-get install tmux
    fi
}


##################################################################
# Link files to $HOME
##################################################################

LinkFiles() {
    # Link files
    ln -sf "$CONFIG/.zshrc" "$HOME/.zshrc"
    ln -sf "$CONFIG/.sqliterc" "$HOME/.sqliterc"
    ln -sf "$CONFIG/.tmux.conf" "$HOME/.tmux.conf"
    ln -sf "$CONFIG/.ctags" "$HOME/.ctags"
    ln -sf "$CONFIG/.railsrc" "$HOME/.railsrc"
    ln -sf "$CONFIG/.rspec" "$HOME/.rspec"
    ln -sf "$CONFIG/.vimrc" "$HOME/.vimrc"
    ln -sf "$CONFIG/.irbrc" "$HOME/.irbrc"
}


##################################################################
# Installation
##################################################################

if [ "$1" = "brew" ]; then # install brew
    InstallBrew

elif [ "$1" = "vim" ]; then # install vim
    InstallVim

elif [ "$1" = "zsh" ]; then # install oh-my-zsh
    InstallZsh
    InstallOhMyZsh

elif [ "$1" = "powerline" ]; then # install Powerline
    InstallPython
    InstallPowerline

elif [ "$1" = "tmux" ]; then # install tmux
    InstallTmux

elif [ "$1" = "link" ]; then # Link all dotfiles
    LinkFiles

elif [ "$1" = "all" ]; then
    LinkFiles

    InstallBrew
    InstallZsh
    InstallOhMyZsh
    InstallPython
    InstallPowerline
    InstallTmux
    InstallVim

else
  Usage

fi

